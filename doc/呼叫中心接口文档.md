

推荐使用typora软件查看编辑markdown文档

##### 文档创建日期：2020年3月18日

### 名词定义

项目：业务运营方承接的甲方的呼叫需求，在系统中新建项目，顾问报名参与项目，顾问报名通过后进入项目工作台

任务：项目下的呼叫执行实例，每个项目下有一个以上的呼叫执行实例

分机：SIP软电话账号，会为每个项目分配临时的分机号段，分配给该项目下的顾问，顾问进入工作台后软电话使用该账号与服务端建立连接，项目完结后注销分机

线路：SIP网关，用于接入PSTN（公共交换电话网是一种用于全球语音通信的电路交换网络），有限资源

#接口文档


## 一、呼叫中心模块（管理系统后台程序调用）



### 接口基础说明

接口基于https协议，接口应由服务端程序调用，做访问IP白名单等相关安全策略

Request Headers主要参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述                                          |
| ---- | ------------ | -------- | ---- | ------------------------------------------------- |
| 1    | timestamp    | Long     | √    | 请求时间戳 毫秒数                                 |
| 2    | sign         | String   | √    | 签名字符串 sign=MD5(account + timestamp + secret) |
| 3    | account      | String   | √    | 应用账号                                          |
| 4    | Content-Type | String   | √    | application/x-www-form-urlencoded; charset=UTF-8  |

Response Headers主要参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述                       |
| ---- | ------------ | -------- | ---- | ------------------------------ |
| 1    | Content-Type | String   | √    | application/json;charset=UTF-8 |

### 1、创建项目获得分机

| API路径  | POST: /callcenter/callProject/api/createProject/v1 |
| -------- | -------------------------------------------------- |
| 创建作者 | striveh                                             |
| 时间     | 2020-4-1                                           |
| 备注     | 创建项目获得分机                                   |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述                                     |
| ---- | ----------- | -------- | ---- | -------------------------------------------- |
| 1    | projectCode | String   | √    | 项目代码                                     |
| 2    | seats       | Integer  | √    | 顾问坐席数，根据此参数计算分配项目执行服务器 |

结果（json）

```json
{
    "data":{
		   "certificate":"2A5E4FE00E3839C10CBBA45687811342",//坐席领取项目分机凭证
       "servers":"wss://fs.xxx.com:7443", //服务器地址，webrtc用
       "nativeServers":"fs.xxx.com:5161" //服务器地址，native客户端软电话用
    },
	 "reqResult" : {
		 "code" : 1,
		 "msg" : "成功"
	 }
}
```

### 2、取得线路资源信息

| API路径  | GET: /freeswitch/gateway/api/getAvailableList/v1 |
| -------- | ------------------------------------------------ |
| 创建作者 | striveh                                           |
| 时间     | 2020-3-23                                        |
| 备注     | 获取线路网关信息以供创建拨打任务时选择           |

参数说明

| NO   | 参数名 | 参数类型 | 必需 | 参数描述 |
| ---- | ------ | -------- | ---- | -------- |
|      |        |          |      |          |

结果（json）		

```json
{
	"data":[{
           "gwCode":"1000",  //线路编号
           "gwName":"电信180号段SIM卡",  //线路名称
           "concurrency":100,  //最大并发量
           "usedConcurrency":100,  //已用并发量
           "availableConcurrency":100,  //可用并发量
           "remark":"备注描述信息便于选择"
    },{
           "gwCode":"1001",  //线路编号
           "gwName":"移动150号段SIM卡",  //线路名称
           "concurrency":100,  //最大并发量
           "usedConcurrency":100,  //已用并发量
           "availableConcurrency":100,  //可用并发量
           "remark":"备注描述"
    }],
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 3、提交呼叫任务

| API路径  | POST: /callcenter/callTask/api/submitCallTask/v1 |
| -------- | ------------------------------------------------ |
| 创建作者 | striveh                                           |
| 时间     | 2020-3-24                                        |
| 备注     | 提交呼叫任务                                     |

参数说明

| NO   | 参数名           | 参数类型 | 必需 | 参数描述             |
| ---- | ---------------- | -------- | ---- | -------------------- |
| 1    | callTaskCode | String   | √    | 任务代码             |
| 2    | scheduleType | Integer  | √    | 系统调拨类型，1直接转坐席2播放录音后转坐席3先接坐席再拨客户4摘机坐席5播放录音\|11客户拨入后接坐席 |
| 3    | callType | Integer | √    | 拨打类型，1预测式拨打2预览式拨打3客户拨入 |
| 4    | callGWs      | JSONObject | √    | 线路列表[{"code":"1001","concurrency":100},{"code":"1002","concurrency":200}] |
| 5 | callListId   | String     | X   | 呼叫号码列表ID ，不传则执行重呼流程                                 |
| 6 | expiredTime | Datetime | √ | 过期时间 |
| 7 | projectCode | String | √ | 项目代码 |
| 8 | rate | Double | √ | 拨打倍率 |
| 9 | originalResultDetail | String | X | 呼叫结果，1:空号5:未接通10:呼叫被拒绝20:客户忙25:客户未接听28:等待坐席接通时挂断30:坐席忙32:坐席未接听35:坐席全忙40:排队超时挂断50:呼叫成功坐席挂断55:呼叫成功客户挂断。 原任务结果，重呼时必传 |
| 10 | originalCallTaskCode | String | X | 原任务代码，重呼时必传 |
| 11 | voiceCode | String | X | 语音代码，当scheduleType等于2或5时必传 |

结果（json）

```json
{
	 "reqResult" : {
		 "code" : 1,
		 "msg" : "成功"
	 }
}
```

### 4、坐席认领项目分机

| API路径  | GET: /callcenter/callProject/api/getByCertificate/v1 |
| -------- | ---------------------------------------------------- |
| 创建作者 | striveh                                               |
| 时间     | 2020-3-30                                            |
| 备注     | 顾问进入项目工作台后根据凭证获取分机信息             |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述           |
| ---- | ----------- | -------- | ---- | ------------------ |
| 1    | certificate | String   | √    | 坐席领取分机凭证   |
| 2    | username    | String   | X    | 分配给坐席的分机号 |
| 3    | type        | Integer  | √    | 2坐席顾问3项目经理 |

结果（json）

```json
{
   "data":{
       "servers":"wss://fs.xxx.com:7443", //服务器地址，webrtc用
       "nativeServers":"fs.xxx.com:5161", //服务器地址，native客户端软电话用
       "username":"1000", //分机号码
       "password":"a12345",  //密码
       "uri":"sip:1000@fs.xxx.com"
   },
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 5、呼叫任务启动

| API路径  | POST: /callcenter/callTask/api/callTaskStart/v1 |
| -------- | ----------------------------------------------- |
| 创建作者 | striveh                                          |
| 时间     | 2020-3-26                                       |
| 备注     |                                                 |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述 |
| ---- | ------------ | -------- | ---- | -------- |
| 1    | callTaskCode | String   | √    | 任务代码 |

结果（json）

```json
{
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 6、设置任务并发数

| API路径  | POST: /callcenter/callTask/api/setTaskConcurrent/v1 |
| -------- | --------------------------------------------------- |
| 创建作者 | striveh                                              |
| 时间     | 2020-3-30                                           |
| 备注     |                                                     |

参数说明

| NO   | 参数名       | 参数类型   | 必需 | 参数描述                                                     |
| ---- | ------------ | ---------- | ---- | ------------------------------------------------------------ |
| 1    | callTaskCode | String     | √    | 任务代码                                                     |
| 2    | callGWs      | JSONObject | √    | 线路列表[{"code":"1001","concurrency":100},{"code":"1002","concurrency":200}] |
| 3    | rate         | Integer    | √    | 拨打倍率                                                     |

结果（json）

```json
{
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 7、呼叫任务暂停

| API路径  | POST: /callcenter/callTask/api/callTaskPause/v1 |
| -------- | ----------------------------------------------- |
| 创建作者 | striveh                                          |
| 时间     | 2020-3-24                                       |
| 备注     |                                                 |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述 |
| ---- | ------------ | -------- | ---- | -------- |
| 1    | callTaskCode | String   | √    | 任务代码 |

结果（json）

```json
{
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 8、获取任务进度

| API路径  | POST: /callcenter/callTask/api/callTaskStatus/v1 |
| -------- | ------------------------------------------------ |
| 创建作者 | striveh                                           |
| 时间     | 2020-3-26                                        |
| 备注     |                                                  |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述 |
| ---- | ------------ | -------- | ---- | -------- |
| 1    | callTaskCode | String   | √    | 任务代码 |

结果（json）

```json
{
  "data":{
       "successCount":1000,//成功数
       "failCount":780,//失败数
       "missCount":220,//漏接数
  },
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```



### 9、获取项目分机状态

| API路径  | GET: /callcenter/callProject/api/getExtentionByProject/v1 |
| -------- | --------------------------------------------------------- |
| 创建作者 | striveh                                                    |
| 时间     | 2020-3-30                                                 |
| 备注     |                                                           |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述 |
| ---- | ----------- | -------- | ---- | -------- |
| 1    | projectCode | String   | √    | 项目代码 |
|      |             |          |      |          |

结果（json）

```json
{
   "data":[{  
       "username":"1000", //分机号码
       "status":0,//0未注册、1已注册，注册是指使用软电话跟服务端建立的连接
       "workStatus":0,//-1不可用、0不可通话、1可通话
       "sessionStatus":0,//0未通话、10通话中
       "destinationNumber":"xxx", //通过中的号码
       "destinationUUID":"ea7293a1-41e4-41a5-8fdb-7a5cfc390697"
    }],
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 10、获取项目呼叫结果

| API路径  | GET: /callcenter/callLog/api/getList/v1 |
| -------- | --------------------------------------- |
| 创建作者 | striveh                                  |
| 时间     | 2020-3-25                               |
| 备注     |                                         |

参数说明

| NO   | 参数名        | 参数类型 | 必需 | 参数描述                                  |
| ---- | ------------- | -------- | ---- | ----------------------------------------- |
| 1    | pageNum       | Integer  | X    | 第几页                                    |
| 2    | pageSize      | Integer  | X    | 每页条数                                  |
| 3    | projectCode   | String   | X    | 项目代码                                  |
| 4    | callTaskCode  | String   | X    | 任务代码                                  |
| 5    | beginTime     | Datetime | X    | 查询开始时间                              |
| 6    | endTime       | Datetime | X    | 查询结束时间                              |
| 7    | queryTimeType | Integer  | √    | 查询时间类型1:呼叫开始时间2：呼叫结束时间 |

结果（json）

```json
{
    "data":{
      "total":1000,//总数
      "items":[{  
        "id":1, //ID
        "callTaskCode":"1", //任务代码
        "callerIdNumber":"1000",  //坐席分机号
        "destinationNumber":"xxx", //外呼号码
        "recordFile":"/var/lib/freeswitch/recordings/2020-05-15-16-47-32.20042871.mp3", //录音文件在服务器上的本机地址
        "recordFileQiniu":"zprecord|2020-05-15-16-47-32.20042871.mp3", //录音文件在七牛云存储地址
        "startTimestamp":1585287982000, //外呼开始时间
        "endTimestamp":1585288070000, //外呼结束时间
        "addTime":1585287982000, //记录创建时间
        "updateTime":1585288070000, //记录更新时间
        "duration":31, //通话时长,单位秒
        "billsec":20, //计费时长,单位秒
        "priceCal": 30.0,//实际计算价格,单位分
        "priceRule": "6|10.0",//每多少秒多少钱
        "result":"10", //呼叫结果，10:成功20:失败30:漏接
        "resultDetail":"55", //呼叫结果，1:空号5:未接通10:呼叫被拒绝20:客户忙25:客户未接听28:等待坐席接通时挂断30:坐席忙32:坐席未接听35:坐席全忙40:排队超时挂断50:呼叫成功坐席挂断55:呼叫成功客户挂断
        "evaluation":1 //用户满意度评分，1非常满意2满意3不满意
    	}]
    },
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```
### 11、置忙置闲

| API路径  | POST: /callcenter/callProject/api/setWorkStatus/v1 |
| -------- | -------------------------------------------------- |
| 创建作者 | striveh                                             |
| 时间     | 2020-4-2                                           |
| 备注     |                                                    |

参数说明

| NO   | 参数名     | 参数类型 | 必需 | 参数描述           |
| ---- | ---------- | -------- | ---- | ------------------ |
| 1    | workStatus | String   | X   | 0不可通话、1可通话 |
| 2    | username  | String   | √    | 分配给坐席的分机号 |

结果（json）

```json
{   
  "data":{  
       "username":"1000", //分机号码
       "workStatus":0,//-1不可用、0不可通话、1可通话
       "sessionStatus":0//0未通话、1通话中
    },
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 12、完结项目

| API路径  | POST:/callcenter/callProject/api/finishProject/v1 |
| -------- | ------------------------------------------------- |
| 创建作者 | striveh                                            |
| 时间     | 2020-4-2                                          |
| 备注     | 项目结束、注销分机                                |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述 |
| ---- | ----------- | -------- | ---- | -------- |
| 1    | projectCode | String   | √    | 项目代码 |

结果（json）

```json
{
	 "reqResult" : {
		 "code" : 1,
		 "msg" : "成功"
	 }
}
```

### 13、获取重呼呼叫列表

| API路径  | GET: /callcenter/callLog/api/getListByResult/v1 |
| -------- | ----------------------------------------------- |
| 创建作者 | striveh                                          |
| 时间     | 2020-3-25                                       |
| 备注     |                                                 |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述                                                     |
| ---- | ------------ | -------- | ---- | ------------------------------------------------------------ |
| 1    | resultDetail | String   | √    | 呼叫结果，1:空号5:未接通10:呼叫被拒绝20:客户忙25:客户未接听28:等待坐席接通时挂断30:坐席忙32:坐席未接听35:坐席全忙40:排队超时挂断50:呼叫成功坐席挂断55:呼叫成功客户挂断 |
| 2    | callTaskCode | String   | √    | 任务代码                                                     |
| 3    | pageNum      | Integer  | X    | 第几页                                                       |
| 4    | pageSize     | Integer  | X    | 每页条数                                                     |
| 5    | recallLastId | Long     | √    | 重呼时返回的重呼呼叫列表的最后一条记录的ID                   |

结果（json）

```json
{
    "data":{
      "total":1,
      "items":[{  
        "destinationNumber":"xxx"//被叫号码
    	}]
    },
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 14、呼叫任务追加

| API路径  | POST: /callcenter/callTask/api/callTaskAdditional/v1 |
| -------- | ---------------------------------------------------- |
| 创建作者 | striveh                                               |
| 时间     | 2020-4-28                                            |
| 备注     |                                                      |

参数说明

| NO   | 参数名         | 参数类型 | 必需 | 参数描述                     |
| ---- | -------------- | -------- | ---- | ---------------------------- |
| 1    | callTaskCode   | String   | √    | 任务代码                     |
| 2    | callListLastId | Long     | √    | 呼叫列表在追加前的最后一个ID |

结果（json）

```json
{
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 15、添加线路

| API路径  | POST: /freeswitch/gateway/api/add/v1 |
| -------- | ------------------------------------ |
| 创建作者 | striveh                               |
| 时间     | 2020-5-6                             |
| 备注     |                                      |

参数说明

| NO   | 参数名            | 参数类型 | 必需 | 参数描述                                                     |
| ---- | ----------------- | -------- | ---- | ------------------------------------------------------------ |
| 1    | gwName            | String   | √    | 线路名称                                                     |
| 2    | registerType      | Integer  | √    | 线路对接类型1主动模式2被动模式                               |
| 3    | originationCallId | String   | X    | 主叫号码                                                     |
| 4    | codec             | String   | X    | 语音编码：G711、G722、G726、G723.1、G729、GSM、iLBC、iSAC、CODEC2、Speex、SILK、GELT、OPUS |
| 5    | mobilePhonePrefix | String   | X    | 呼叫手机前缀                                                 |
| 6    | fixedPhonePrefix  | String   | X    | 呼叫座机前缀                                                 |
| 7    | realm             | String   | √    | 对接地址 ,列47.95.236.95:5060                                |
| 8    | username          | String   | X    | 对接账号                                                     |
| 9    | password          | String   | X    | 对接密码                                                     |
| 10   | remark            | String   | X    | 备注说明                                                     |
| 11   | callLimit         | Integer  | X    | 呼叫次数                                                     |
| 12   | billType          | Integer  | X    | 计费方式 1按次数、2按秒(每多少秒多少钱)                      |
| 13   | billsec           | Integer  | X    | 按秒(每多少秒多少钱)秒数                                     |
| 14   | price             | Decimal  | X    | 计费单价（单位元）                                           |
| 15   | status            | Integer  | √    | 状态 0禁用、1启用                                            |
| 16   | expectCount       | Integer  | X    | 预计线路数                                                   |
| 17   | returnVisit       | Integer  | √    | 回访线路: 0否、1是                                           |
| 18   | accountBalance    | Decimal  | X    | 账户余额，单位元                                             |
| 19   | rechargedAmount   | Decimal  | X    | 已充值金额，单位元                                           |

结果（json）		

```json
{
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 16、编辑线路

| API路径  | POST: /freeswitch/gateway/api/update/v1 |
| -------- | --------------------------------------- |
| 创建作者 | striveh                                  |
| 时间     | 2020-5-6                                |
| 备注     |                                         |

参数说明

| NO   | 参数名            | 参数类型 | 必需 | 参数描述                                                     |
| ---- | ----------------- | -------- | ---- | ------------------------------------------------------------ |
| 1    | id                | Integer  | √    | 线路编号                                                     |
| 2    | gwName            | String   | √    | 线路名称                                                     |
| 3    | registerType      | Integer  | √    | 线路对接类型1主动模式2被动模式                               |
| 4    | originationCallId | String   | X    | 主叫号码                                                     |
| 5    | codec             | String   | X    | 语音编码：G711、G722、G726、G723.1、G729、GSM、iLBC、iSAC、CODEC2、Speex、SILK、GELT、OPUS |
| 6    | mobilePhonePrefix | String   | X    | 呼叫手机前缀                                                 |
| 7    | fixedPhonePrefix  | String   | X    | 呼叫座机前缀                                                 |
| 8    | realm             | String   | √    | 对接地址                                                     |
| 9    | username          | String   | X    | 对接账号                                                     |
| 10   | password          | String   | X    | 对接密码                                                     |
| 11   | remark            | String   | X    | 备注说明                                                     |
| 12   | callLimit         | Integer  | X    | 呼叫次数                                                     |
| 13   | billType          | Integer  | X    | 计费方式 1按次数、2按秒(每多少秒多少钱)                      |
| 14   | billsec           | Integer  | X    | 按秒(每多少秒多少钱)秒数                                     |
| 15   | price             | Double   | X    | 计费单价（单位分）                                           |
| 16   | status            | Integer  | √    | 状态 0禁用、1启用                                            |
| 17   | expectCount       | Integer  | X    | 预计线路数                                                   |
| 18   | gwCode            | String   | √    | 线路代码                                                     |
| 19   | returnVisit       | Integer  | √    | 回访线路: 0否、1是                                           |

结果（json）		

```json
{
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 17、获取线路列表

| API路径  | GET: /freeswitch/gateway/api/getList/v1 |
| -------- | --------------------------------------- |
| 创建作者 | striveh                                  |
| 时间     | 2020-5-6                                |
| 备注     |                                         |

参数说明

| NO   | 参数名   | 参数类型 | 必需 | 参数描述          |
| ---- | -------- | -------- | ---- | ----------------- |
| 1    | pageNum  | Integer  | X    | 第几页            |
| 2    | pageSize | Integer  | X    | 每页条数          |
| 3    | status   | Integer  | X    | 状态 0禁用、1启用 |
| 4    | id       | Integer  | X    | 线路ID            |

结果（json）		

```json
{
	"data":{
    	"total":100,//总数
      "items":[{
        "id":1, //ID
        "gwCode":"1000",  //线路编号
        "gwName":"电信180号段SIM卡",  //线路名称
        "remark":"备注描述信息便于选择"
      },{
        "id":2, //ID
        "gwCode":"1001",  //线路编号
        "gwName":"移动150号段SIM卡",  //线路名称
        "remark":"备注描述"
      }]
   },
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 18、全部置忙置闲

| API路径  | POST: /callcenter/callProject/api/setWorkStatusByProjectCode/v1 |
| -------- | ------------------------------------------------------------ |
| 创建作者 | striveh                                                       |
| 时间     | 2020-6-1                                                     |
| 备注     |                                                              |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述           |
| ---- | ----------- | -------- | ---- | ------------------ |
| 1    | workStatus  | String   | √    | 0不可通话、1可通话 |
| 2    | projectCode | String   | √    | 项目代码           |

结果（json）

```json
{   
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 19、呼叫任务结束

| API路径  | POST: /callcenter/callTask/api/callTaskEnd/v1 |
| -------- | --------------------------------------------- |
| 创建作者 | striveh                                        |
| 时间     | 2020-6-2                                      |
| 备注     |                                               |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述 |
| ---- | ------------ | -------- | ---- | -------- |
| 1    | callTaskCode | String   | √    | 任务代码 |

结果（json）

```json
{
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 20、分机禁用启用

| API路径  | POST: /callcenter/callProject/api/setExtensionStatus/v1 |
| -------- | ------------------------------------------------------- |
| 创建作者 | striveh                                                  |
| 时间     | 2020-6-10                                               |
| 备注     |                                                         |

参数说明

| NO   | 参数名     | 参数类型 | 必需 | 参数描述           |
| ---- | ---------- | -------- | ---- | ------------------ |
| 1    | workStatus | String   | X    | -1禁用0启用        |
| 2    | username   | String   | √    | 分配给坐席的分机号 |

结果（json）

```json
{   
  "data":{  
       "username":"1000", //分机号码
       "workStatus":0//-1禁用0启用
    },
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 21、给坐席发消息

| API路径  | POST: /callcenter/callProject/api/sendToUser/v1 |
| -------- | ----------------------------------------------- |
| 创建作者 | striveh                                          |
| 时间     | 2020-6-30                                       |
| 备注     |                                                 |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述           |
| ---- | ----------- | -------- | ---- | ------------------ |
| 1    | projectCode | String   | √    | 项目代码           |
| 2    | username    | String   | X    | 分配给坐席的分机号 |
| 3    | content     | String   | √    | 消息内容           |

结果（json）

```json
{   
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 22、给项目分配坐席

| API路径  | POST: /callcenter/callProject/api/distributionSeat/v1 |
| -------- | ----------------------------------------------------- |
| 创建作者 | striveh                                                |
| 时间     | 2020-8-03                                             |
| 备注     |                                                       |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述           |
| ---- | ----------- | -------- | ---- | ------------------ |
| 1    | projectCode | String   | √    | 项目代码           |
| 2    | username    | String   | √    | 分配给坐席的分机号 |

结果（json）

```json
{   
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 23、给坐席分配号码（预览式拨打）

| API路径  | GET: /callcenter/callTask/api/getCallList/v1 |
| -------- | -------------------------------------------- |
| 创建作者 | striveh                                       |
| 时间     | 2020-12-11                                   |
| 备注     |                                              |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述 |
| ---- | ------------ | -------- | ---- | -------- |
| 1    | callTaskCode | String   | √    | 任务代码 |
| 2    | count        | Integer  | √    | 分配数量 |

结果（json）

```json
{
   "data":{
      "items":[{  
       "phone":"xxx" //号码
       }]
   }
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 24、上传语音文件

| API路径  | POST: /callcenter/callProject/api/uploadVoiceFile/v1 |
| -------- | ---------------------------------------------------- |
| 创建作者 | striveh                                               |
| 时间     | 2020-12-17                                           |
| 备注     |                                                      |

参数说明

| NO   | 参数名        | 参数类型 | 必需 | 参数描述                                |
| ---- | ------------- | -------- | ---- | --------------------------------------- |
| 1    | qiniuStoreKey | String   | √    | 语音文件在七牛文件存储服务器里的存储key |
| 2    | voiceCode     | String   | √    | 语音代码                                |

结果（json）		

```json
{
	"reqResult":{
		"code":1, 
		"msg":"成功"
	}
}
```

### 

## 二、软电话模块（顾问系统前端JS调用）

### 接口基础说明

接口以JavaScript SDK的形式提供，具体使用方式会以Demo的方式提供

### 1、登录分机

| API      | new MySoftPhone(options,answerConfirmFn) |
| -------- | ---------------------------------------- |
| 创建作者 | striveh                                   |
| 时间     | 2020-3-24                                |
| 备注     | 创建软电话客户端并自动登录               |

参数说明

| NO   | 参数名            | 参数类型 | 必需 | 参数描述                    |
| ---- | ----------------- | -------- | ---- | --------------------------- |
| 1    | authorizationUser | String   | √    | 分机号                      |
| 2    | password          | String   | √    | 分机密码                    |
| 3    | wsServers         | String[] | √    | 服务端websocket地址         |
| 4    | uri               | String   | √    | SIP URI                     |
| 5    | remoteVideoId     | String   | √    | 接收远程语音流的Video标签ID |
| 6    | localVideoId      | String   | √    | 发送本机语音流的Video标签ID |
| 7    | answerConfirmFn   | Function | √    | 来电回调函数                |

结果

获得软电话实例mySoftPhone

### 2、注销分机

| API      | mySoftPhone.unregister(options) |
| -------- | ------------------------------- |
| 创建作者 | striveh                          |
| 时间     | 2020-3-24                       |
| 备注     |                                 |

参数说明

| NO   | 参数名           | 参数类型 | 必需 | 参数描述             |
| ---- | ---------------- | -------- | ---- | -------------------- |
|      |        |          |      |          |

结果



### 3、呼出

| API      | mySoftPhone.call(options) |
| -------- | ------------------------- |
| 创建作者 | striveh                    |
| 时间     | 2020-3-24                 |
| 备注     |                           |

参数说明

| NO   | 参数名 | 参数类型 | 必需 | 参数描述 |
| ---- | ------ | -------- | ---- | -------- |
| 1    | target | String   | √    | 被叫号码 |

结果

获得对话session

### 4、 挂断

| API      | session.hangup() |
| -------- | ---------------- |
| 创建作者 | striveh           |
| 时间     | 2020-3-24        |
| 备注     | 挂断、拒接、取消 |

参数说明

| NO   | 参数名 | 参数类型 | 必需 | 参数描述 |
| ---- | ------ | -------- | ---- | -------- |
|      |        |          |      |          |

结果

### 5、保持

| API      | session.hold() |
| -------- | -------------- |
| 创建作者 | striveh         |
| 时间     | 2020-3-24      |
| 备注     |                |

参数说明

| NO   | 参数名 | 参数类型 | 必需 | 参数描述 |
| ---- | ------ | -------- | ---- | -------- |
|      |        |          |      |          |

结果

### 6、取消保持

| API      | session.unhold() |
| -------- | ---------------- |
| 创建作者 | striveh           |
| 时间     | 2020-3-24        |
| 备注     |                  |

参数说明

| NO   | 参数名 | 参数类型 | 必需 | 参数描述 |
| ---- | ------ | -------- | ---- | -------- |
|      |        |          |      |          |

结果

### 7、电话转移盲转

| API      | session.transfer(target) |
| -------- | ------------------------ |
| 创建作者 | striveh                   |
| 时间     | 2020-3-24                |
| 备注     | 盲转                     |

参数说明

| NO   | 参数名 | 参数类型 | 必需 | 参数描述   |
| ---- | ------ | -------- | ---- | ---------- |
| 1    | target | String   | √    | 目标分机号 |

结果

### 8、接听

| 回调API  | answerConfirmFn(target) |
| -------- | ----------------------- |
| 创建作者 | striveh                  |
| 时间     | 2020-3-24               |
| 备注     | 回调坐席系统JS API      |

参数说明

| NO   | 参数名 | 参数类型 | 必需 | 参数描述 |
| ---- | ------ | -------- | ---- | -------- |
| 1    | target | String   | √    | 被叫号码 |

结果

是否接听 true/false

### 9、签入签出

通过拨打“agent_login”进入等待通话接入状态；

通过拨打“agent_logoff”退出等待通话接入状态；

### 10、摘机坐席

默认情况是是挂机坐席，也就是需要接入坐席时系统先呼叫坐席，坐席接听后再通话；

通过拨打“fifo+项目代码”进入摘机坐席模式，坐席与系统间提前建立了会话连接，当有通话需要接入时则可以直接建立通话，不需要先呼叫坐席；

这种模式下因为服务端不会再呼叫坐席，因此客户端无法获知客户信息，如果使用此模式，需要通过websocket的方式 坐席端与业务服务器建立websocket连接，当坐席接通通话时，由业务服务器通知坐席端

## 三、websocket接口

websocket基于 SockJS+STOMP协议

接口地址地址：https://xxx/callcenter/ws

### 1、订阅坐席注册状态

| API      | /topic/register/{username} |
| -------- | -------------------------- |
| 创建作者 | striveh                     |
| 时间     | 2020-7-27                  |
| 备注     | 分机注册注销后状态通知     |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述                     |
| ---- | ------------ | -------- | ---- | ---------------------------- |
| 1    | status       | Integer  | √    | 1已注册0未注册               |
| 2    | workStatus   | Integer  | √    | -1不可用、0不可通话、1可通话 |
| 3    | sessionSatus | Integer  | √    | 0未通话、10通话中            |

### 2、坐席置闲

| API      | /app/idle |
| -------- | --------- |
| 创建作者 | striveh    |
| 时间     | 2020-7-31 |
| 备注     |           |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述                                                     |
| ---- | ----------- | -------- | ---- | ------------------------------------------------------------ |
| 1    | username    | String   | √    | 座机分机号                                                   |
| 2    | workType    | String   | √    | 工作模式，直接转坐席 : 10    坐席长连接转客户:20  客户拨入后接坐席:30 |
| 3    | projectCode | String   | √    | 项目代码                                                     |

### 3、坐席置忙

| API      | /app/busy |
| -------- | --------- |
| 创建作者 | striveh    |
| 时间     | 2020-7-31 |
| 备注     |           |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述                                                     |
| ---- | ----------- | -------- | ---- | ------------------------------------------------------------ |
| 1    | username    | String   | √    | 座机分机号                                                   |
| 2    | workType    | String   | √    | 工作模式，直接转坐席 : 10    坐席长连接转客户:20 客户拨入后接坐席:30 |
| 3    | projectCode | String   | √    | 项目代码                                                     |

### 4、订阅振铃状态

| API      | /topic/call/{username} |
| -------- | ---------------------- |
| 创建作者 | striveh                 |
| 时间     | 2020-7-27              |
| 备注     |                        |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述     |
| ---- | ------------ | -------- | ---- | ------------ |
| 1    | callId       | String   | √    | 呼叫唯一ID   |
| 2    | callTaskCode | String   | √    | 呼叫任务代码 |
| 3    | telNo        | String   | √    | 呼叫号码     |



### 5、订阅坐席工作状态

| API      | /topic/status/{username} |
| -------- | ------------------------ |
| 创建作者 | striveh                   |
| 时间     | 2020-7-27                |
| 备注     |                          |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述                     |
| ---- | ------------ | -------- | ---- | ---------------------------- |
| 1    | workStatus   | Integer  | √    | -1不可用、0不可通话、1可通话 |
| 2    | sessionSatus | Integer  | √    | 0未通话、7会议中、10通话中   |

### 7、订阅来电

| API      | /topic/invite/{username} |
| -------- | ------------------------ |
| 创建作者 | striveh                   |
| 时间     | 2020-7-27                |
| 备注     |                          |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述     |
| ---- | ------------ | -------- | ---- | ------------ |
| 1    | callId       | String   | √    | 呼叫唯一ID   |
| 2    | callTaskCode | String   | √    | 呼叫任务代码 |
| 3    | telNo        | String   | √    | 呼叫号码     |

### 8、订阅挂断

| API      | /topic/bye/{username} |
| -------- | --------------------- |
| 创建作者 | striveh                |
| 时间     | 2020-7-27             |
| 备注     |                       |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述     |
| ---- | ------------ | -------- | ---- | ------------ |
| 1    | callId       | String   | √    | 呼叫唯一ID   |
| 2    | callTaskCode | String   | √    | 呼叫任务代码 |
| 3    | telNo        | String   | √    | 呼叫号码     |



### 9、订阅消息

| API      | /topic/notify/{projectCode}/{username} |
| -------- | -------------------------------------- |
| 创建作者 | striveh                                 |
| 时间     | 2020-7-27                              |
| 备注     |                                        |

参数说明

| NO   | 参数名  | 参数类型 | 必需 | 参数描述                                                     |
| ---- | ------- | -------- | ---- | ------------------------------------------------------------ |
| 1    | content | String   | √    | 已定义json格式{ "duration":"3", "msgType":"success", "data":"置闲成功", "type":"message" } |

### 10、订阅任务状态

| API      | /topic/task/{projectCode} |
| -------- | ------------------------- |
| 创建作者 | striveh                    |
| 时间     | 2020-7-27                 |
| 备注     |                           |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述                   |
| ---- | ------------ | -------- | ---- | -------------------------- |
| 1    | status       | Integer  | √    | 状态1初始化2启动3暂定4结束 |
| 2    | callTaskCode | String   | √    | 任务代码                   |
|      |              |          |      |                            |

### 11、拨打

| API      | /app/call |
| -------- | --------- |
| 创建作者 | striveh    |
| 时间     | 2020-7-31 |
| 备注     |           |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述   |
| ---- | ----------- | -------- | ---- | ---------- |
| 1    | username    | String   | √    | 座机分机号 |
| 2    | telNo       | String   | √    |            |
| 3    | projectCode | String   | √    | 项目代码   |

### 12、挂断

| API      | /app/bye  |
| -------- | --------- |
| 创建作者 | striveh    |
| 时间     | 2020-7-31 |
| 备注     |           |

参数说明

| NO   | 参数名   | 参数类型 | 必需 | 参数描述   |
| ---- | -------- | -------- | ---- | ---------- |
| 1    | callId   | String   | √    | 呼叫唯一ID |
| 2    | username | String   | √    | 坐席分机号 |

### 13、后台管理订阅坐席状态

| API      | /topic/callExtStatus/{projectCode} |
| -------- | ---------------------------------- |
| 创建作者 | striveh                             |
| 时间     | 2020-7-27                          |
| 备注     |                                    |

参数说明

| NO   | 参数名            | 参数类型 | 必需 | 参数描述                     |
| ---- | ----------------- | -------- | ---- | ---------------------------- |
| 1    | workStatus        | Integer  | √    | -1不可用、0不可通话、1可通话 |
| 2    | sessionStatus     | Integer  | √    | 0未通话、7会议中、10通话中   |
| 3    | status            | Integer  | √    | 1已注册0未注册               |
| 4    | username          | String   | √    | 坐席分机号                   |
| 5    | destinationNumber | String   | X    | 通话中的号码                 |
| 6    | destinationUUID   | String   | X    | 通话中的唯一标识号           |
|      |                   |          |      |                              |

### 14、后台管理订阅任务状态

| API      | /topic/callTaskStatus/{projectCode} |
| -------- | ----------------------------------- |
| 创建作者 | striveh                              |
| 时间     | 2020-7-27                           |
| 备注     |                                     |

参数说明

| NO   | 参数名     | 参数类型 | 必需 | 参数描述                   |
| ---- | ---------- | -------- | ---- | -------------------------- |
| 1    | code       | String   | √    | 呼叫任务代码               |
| 2    | totalCnt   | Integer  | √    | 呼叫总数                   |
| 3    | failCnt    | Integer  | √    | 失败数                     |
| 4    | rejectCnt  | Integer  | √    | 呼叫拒绝数                 |
| 5    | missCnt    | Integer  | √    | 漏接数                     |
| 6    | successCnt | Integer  | √    | 成功数                     |
| 7    | rate       | Double   | √    | 拨打倍率                   |
| 8    | status     | Integer  | √    | 状态1初始化2启动3暂定4结束 |
| 9    | runningCnt | Integer  | √    | 执行中数                   |

### 15、监听坐席通话

| API      | /app/eavesdrop       |
| -------- | -------------------- |
| 创建作者 | striveh               |
| 时间     | 2020-8-31            |
| 备注     | 项目经理监听坐席通话 |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述     |
| ---- | ----------- | -------- | ---- | ------------ |
| 1    | username    | String   | √    | 座机分机号   |
| 2    | listenerExt | String   | √    | 监听者分机号 |
| 3    | projectCode | String   | √    | 项目代码     |

### 16、监听坐席结束

| API      | /app/stopEavesdrop       |
| -------- | ------------------------ |
| 创建作者 | striveh                   |
| 时间     | 2020-8-31                |
| 备注     | 项目经理结束监听坐席通话 |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述     |
| ---- | ----------- | -------- | ---- | ------------ |
| 1    | username    | String   | √    | 座机分机号   |
| 2    | listenerExt | String   | √    | 监听者分机号 |
| 3    | projectCode | String   | √    | 项目代码     |

###17、项目经理发起会议

| API      | /app/conference                                      |
| -------- | ---------------------------------------------------- |
| 创建作者 | striveh                                               |
| 时间     | 2020-8-31                                            |
| 备注     | 项目经理与坐席会议，发起会议呼叫所有在线坐席参加会议 |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述     |
| ---- | ----------- | -------- | ---- | ------------ |
| 1    | projectCode | String   | √    | 项目代码     |
| 2    | listenerExt | String   | √    | 监听者分机号 |

### 18、项目经理邀请坐席参加会议

| API      | /app/conferenceByUsername      |
| -------- | ------------------------------ |
| 创建作者 | striveh                         |
| 时间     | 2020-8-31                      |
| 备注     | 项目经理单独向坐席发起会议请求 |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述     |
| ---- | ----------- | -------- | ---- | ------------ |
| 1    | username    | String   | √    | 坐席分机号   |
| 2    | listenerExt | String   | √    | 监听者分机号 |
| 3    | projectCode | String   | √    | 项目代码     |

### 19、项目经理结束会议

| API      | /app/stopConference |
| -------- | ------------------- |
| 创建作者 | striveh              |
| 时间     | 2020-8-31           |
| 备注     | 项目经理结束会议    |

参数说明

| NO   | 参数名      | 参数类型 | 必需 | 参数描述     |
| ---- | ----------- | -------- | ---- | ------------ |
| 1    | projectCode | String   | √    | 项目代码     |
| 2    | listenerExt | String   | √    | 监听者分机号 |

### 20、项目经理给坐席打电话

| API      | /app/pmCallAgent |
| -------- | ---------------- |
| 创建作者 | striveh           |
| 时间     | 2020-10-30       |
| 备注     |                  |

参数说明

| NO   | 参数名   | 参数类型 | 必需 | 参数描述 |
| ---- | -------- | -------- | ---- | -------- |
| 1    | username | String   | √    | 分机号   |
| 2    | telNo    | String   | √    |          |

### 21、项目经理给坐席打电话挂断

| API      | /app/pmByeAgent |
| -------- | --------------- |
| 创建作者 | striveh          |
| 时间     | 2020-10-30      |
| 备注     |                 |

参数说明

| NO   | 参数名   | 参数类型 | 必需 | 参数描述   |
| ---- | -------- | -------- | ---- | ---------- |
| 1    | callId   | String   | √    | 呼叫唯一ID |
| 2    | username | String   | √    | 分机号     |

### 22、坐席点拨（预览式拨打）

| API      | /app/previewCall |
| -------- | ---------------- |
| 创建作者 | striveh           |
| 时间     | 2020-12-9        |
| 备注     |                  |

参数说明

| NO   | 参数名       | 参数类型 | 必需 | 参数描述 |
| ---- | ------------ | -------- | ---- | -------- |
| 1    | username     | String   | √    | 分机号   |
| 2    | telNo        | String   | √    |          |
| 3    | callTaskCode | String   | √    |          |

### 23、坐席播放语音

| API      | /app/playVoice |
| -------- | -------------- |
| 创建作者 | striveh         |
| 时间     | 2020-12-17     |
| 备注     |                |

参数说明

| NO   | 参数名    | 参数类型 | 必需 | 参数描述       |
| ---- | --------- | -------- | ---- | -------------- |
| 1    | username  | String   | √    | 分机号         |
| 2    | callId    | String   | √    | 呼叫唯一ID     |
| 3    | voiceCode | String   | √    | 播放的语音代码 |

### 24、坐席停止播放语音

| API      | /app/stopPlayVoice |
| -------- | ------------------ |
| 创建作者 | striveh             |
| 时间     | 2020-12-17         |
| 备注     |                    |

参数说明

| NO   | 参数名    | 参数类型 | 必需 | 参数描述       |
| ---- | --------- | -------- | ---- | -------------- |
| 1    | username  | String   | √    | 分机号         |
| 2    | callId    | String   | √    | 呼叫唯一ID     |
| 3    | voiceCode | String   | √    | 播放的语音代码 |

### 25、坐席通话转移

| API      | /app/transfer |
| -------- | ------------- |
| 创建作者 | striveh        |
| 时间     | 2020-12-25    |
| 备注     |               |

参数说明

| NO   | 参数名        | 参数类型 | 必需 | 参数描述         |
| ---- | ------------- | -------- | ---- | ---------------- |
| 1    | username      | String   | √    | 分机号           |
| 2    | callId        | String   | √    | 呼叫唯一ID       |
| 3    | otherUsername | String   | √    | 接受转移的分机号 |

### 26、订阅转接来电

| API      | /topic/transfer/{username} |
| -------- | -------------------------- |
| 创建作者 | striveh                     |
| 时间     | 2020-12-28                 |
| 备注     |                            |

参数说明

| NO   | 参数名   | 参数类型 | 必需 | 参数描述   |
| ---- | -------- | -------- | ---- | ---------- |
| 1    | callId   | String   | √    | 呼叫唯一ID |
| 2    | username | String   | √    | 坐席分机号 |
| 3    | telNo    | String   | √    | 呼叫号码   |

### 

